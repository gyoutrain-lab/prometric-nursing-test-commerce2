<!DOCTYPE html>
<html lang="en">
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Nursing Prometric Test Unlock</title>

<!-- SOCIAL THUMBNAIL -->
<meta property="og:title" content="Nursing Prometric Test Unlock" />
<meta property="og:description" content="Confirm payment to unlock the full 500â€‘item test." />
<meta property="og:image" content="thumbnail.jpg" />
<meta property="og:image:width" content="1200" />
<meta property="og:image:height" content="630" />

<style>
body { font-family: Arial, sans-serif; background:#eef5f5; margin:0; padding:0; }
.container { max-width:500px; margin:20px auto; background:#fff; padding:20px; border-radius:12px; box-shadow:0 0 10px rgba(0,0,0,0.12); }
input { width:100%; padding:12px; margin-top:12px; border:1px solid #ccc; border-radius:8px; font-size:16px; }
button { width:100%; padding:14px; margin-top:14px; border:none; border-radius:8px; background:#0077cc; color:#fff; font-size:17px; font-weight:bold; }
button:disabled { background:#999; }
#status { margin-top:15px; font-weight:bold; color:red; }

/* ANDROID FIX: Proper layer order for waterflow + text */
.wrapper { position:relative; width:100%; max-width:500px; margin:auto; }
.waterflow { position:absolute; top:0; left:0; width:100%; opacity:0.45; z-index:1; }
.text-top-layer { position:relative; z-index:5; padding:10px; }
</style>
</head>
<body>

<div class="wrapper">
  <img src="waterflow.png" class="waterflow" />
  <div class="text-top-layer">
    <div class="container">
      <h2>Payment Proof & Confirmation</h2>
      <p>Fill your details. Admin will receive notification and send unlock code manually.</p>

      <input id="nameInput" placeholder="Your Name" />
      <input id="waInput" placeholder="WhatsApp Number" />

      <button id="confirmBtn" disabled>Send Confirmation</button>
      <div id="status"></div>
    </div>
  </div>
</div>

<script>
/* ============================
   SYSTEM SETTINGS
=============================*/
const GAS_URL = "https://script.google.com/macros/s/AKfycbzrJHGo_qoYg3pFJIUADJ00E5Bh0f-WvaQoiXQ0xupjR5n6Rm2nps1GlSMrJZtsyCyseQ/exec";
const SESSION_KEY = "unlock_session";
const SESSION_LIMIT = 1; // limit 1 submission per device

/* ============================
   SESSION CONTROL
=============================*/
if (!localStorage.getItem(SESSION_KEY)) {
  localStorage.setItem(SESSION_KEY, SESSION_LIMIT);
}
else {
  let used = Number(localStorage.getItem(SESSION_KEY));
  if (used >= SESSION_LIMIT) {
    document.getElementById("confirmBtn").disabled = true;
    document.getElementById("status").textContent = "You already submitted. Wait for admin response.";
  }
}

/* ============================
   ELEMENTS
=============================*/
const nameInput = document.getElementById("nameInput");
const waInput = document.getElementById("waInput");
const confirmBtn = document.getElementById("confirmBtn");
const statusBox = document.getElementById("status");

function checkInputs() {
  confirmBtn.disabled = !(nameInput.value.trim() && waInput.value.trim());
}

nameInput.addEventListener('input', checkInputs);
waInput.addEventListener('input', checkInputs);

/* ============================
   SEND CONFIRMATION
=============================*/
confirmBtn.addEventListener('click', async () => {
  const n = nameInput.value.trim();
  const w = waInput.value.trim();

  if (!n || !w) return;

  statusBox.textContent = "Sending...";

  try {
    let res = await fetch(GAS_URL, {
      method: "POST",
      body: JSON.stringify({
        action: "payment_confirm",
        name: n,
        wa: w,
        sessionID: localStorage.getItem(SESSION_KEY)
      })
    });

    let out = await res.text();
    statusBox.textContent = out;

    // Mark usage
    localStorage.setItem(SESSION_KEY, SESSION_LIMIT);

  } catch (e) {
    statusBox.textContent = "Network error: Failed to send";
  }
});
</script>
</body>
</html>

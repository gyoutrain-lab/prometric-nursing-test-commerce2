<input type="text" id="userNameInput" placeholder="Enter your name">
<input type="text" id="userWAInput" placeholder="Enter your WA #">
<button id="confirm-btn" onclick="confirmPayment()">Confirmation</button>
<input type="text" class="unlock-code" id="unlockCodeInput" placeholder="Enter unlock code" disabled>
<button id="continue-btn" onclick="checkUnlockCode()" disabled>Continue the Test</button>

<script>
let unlockCode = "";
let paymentApproved = false;

function confirmPayment() {
  const name = document.getElementById("userNameInput").value.trim();
  const wa = document.getElementById("userWAInput").value.trim();
  if (!name || !wa) { alert("Please fill Name + WA."); return; }

  const adminMsg = `Payment Pending:\nName: ${name}\nWA #: ${wa}`;
  window.open(`https://wa.me/6285399652487?text=${encodeURIComponent(adminMsg)}`, "_blank");

  document.getElementById("unlockCodeInput").disabled = true;
  document.getElementById("continue-btn").disabled = true;

  const GAS_URL = "https://script.google.com/macros/s/AKfycbwybh4YFgmHrCvj_ByZsWetFwZxg586XNlXV3rL_-S2exlqIxPEvStb_6pxgI23MbAGYg/exec"; // <-- replace

  fetch(GAS_URL, {
    method: "POST",
    body: JSON.stringify({ name: name, wa: wa })
  })
  .then(res => res.json())
  .then(data => {
    if (data.status === "approved") {
      unlockCode = data.unlockCode.toUpperCase();
      paymentApproved = true;
      document.getElementById("unlockCodeInput").disabled = false;
      document.getElementById("continue-btn").disabled = false;
      alert("Payment confirmed! Enter unlock code to continue.");
    } else if (data.status === "error") {
      alert("Error: " + data.message);
    }
  })
  .catch(err => console.log("Error:", err));
}

function checkUnlockCode() {
  const codeInput = document.getElementById("unlockCodeInput").value.trim().toUpperCase();
  if (!codeInput) { alert("Enter unlock code."); return; }
  if (!paymentApproved) { alert("Wait for approval."); return; }
  if (codeInput === unlockCode) {
    alert("Unlock code valid! Redirecting...");
    window.location.href = "https://gyoutrain-lab.github.io/nursing-prometric-test-allinone500/";
  } else {
    alert("Invalid unlock code. Check with admin.");
  }
}
</script>
